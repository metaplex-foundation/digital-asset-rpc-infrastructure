name: Deploy Devnet/Testnet
on:
  release:
    types: [published]
  workflow_dispatch:
env:
  RUST_TOOLCHAIN: stable
jobs:
  deploy:
    runs-on: ubuntu-latest
    environment: devnet
    steps:
      - uses: actions/github-script@v6
        with:
          github-token: ${{ secrets.CROSSREPOTRIGGER }}
          script: |
            let params =  {
              owner: "metaplex-foundation",
              repo: "read-api-deployment"
            };
            await github.rest.repos.createDispatchEvent(Object.assign({
              event_type: "deploy_trigger",
              client_payload: {
                DEPLOY_ENV: "devnet",
                DEPLOY_K8S_NAMESPACE: "devnet-read-api",
                DEPLOY_K8S_CLUSTER: "metaplex-dev-001",
                DEPLOY_VERSION: "${{ github.sha }}"
              }
            }, params));